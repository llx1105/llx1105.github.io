---
layout: post
title: ruby元编程第三章读书笔记
category: 技术
tags:
keywords: 元编程
description: block
---

块是被称为'可调用对象'的大家族中的一员，这个家族中还有像proc和lamda这样的对象。块体现了函数式编程语言的一些特点。

## 1. 基础
1) 块可以定义在一个大括号中，也可以放在do...end关键字中，大部分情况下对于只有一行的块我们使用大括号，而对多行的块使用do...end关键字。
2) block_given? 询问当前的方法调用是否包含块
3) yield 调用一个块 ，如果没有传入一个block而使用了yield，会得到一个错误  no block given (yield)


## 2. 闭包
1) 块的运行需要一个执行环境。比如局部变量、实例变量、self,可以把他们简称为绑定 (binding)
2) 定义一个块时，他会获得当时环境中的绑定，并且把它传给一个方法时，他会带着这些绑定一起进入该方法。方法中的变量对于块来说是不可见的。因此叫做闭包。

```
def my_method
  x = 1 #块取不到这个x
  yield(2)
end

x = 2 #这个x绑定在块定义时。
my_method do |y|
  "x = #{x}, y = #{y}"
end

"x = 2, y = 2"
```
可以看到，块里面输出的x是在块定义的时候绑定的，而非方法里面的x。

## 3. 作用域
1) 块局部变量，块会在定义时获取周围的绑定，我们也可以在块的内部定义额外的绑定，但是这些绑定在块结束时就会消失。
